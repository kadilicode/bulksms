<!DOCTYPE html>
<html lang="sw">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZenoAPI Tester - Sensible</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #f0f2f5; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .card { background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 8px 24px rgba(0,0,0,0.1); width: 100%; max-width: 450px; }
        h2 { color: #1a73e8; margin-top: 0; text-align: center; border-bottom: 2px solid #e8f0fe; padding-bottom: 10px; }
        .group { margin-bottom: 1rem; }
        label { display: block; margin-bottom: 6px; font-weight: 600; color: #444; }
        input, textarea { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 15px; transition: border 0.3s; }
        input:focus, textarea:focus { border-color: #1a73e8; outline: none; }
        textarea { height: 110px; resize: none; }
        button { width: 100%; padding: 14px; background-color: #1a73e8; color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; transition: 0.3s; margin-top: 10px; }
        button:hover { background-color: #1557b0; }
        button:disabled { background-color: #ccc; cursor: not-allowed; }
        #status { margin-top: 20px; padding: 15px; border-radius: 8px; display: none; font-size: 14px; line-height: 1.5; }
        .success { background-color: #e6f4ea; color: #1e7e34; border: 1px solid #34a853; }
        .error { background-color: #fce8e6; color: #d93025; border: 1px solid #ea4335; }
        .loading-text { text-align: center; color: #666; font-style: italic; display: none; }
    </style>
</head>
<body>

<div class="card">
    <h2>SMS Portal - Sensible</h2>
    
    <div class="group">
        <label>Sender ID</label>
        <input type="text" id="sender_id" value="Sensible" disabled>
    </div>

    <div class="group">
        <label>Namba za Simu (255...)</label>
        <input type="text" id="contacts" placeholder="Mfano: 255652449389, 2557XXXXXXXX">
    </div>

    <div class="group">
        <label>Ujumbe</label>
        <textarea id="message" placeholder="Andika ujumbe wako hapa..."></textarea>
    </div>

    <button onclick="sendSMS()" id="submitBtn">Tuma Sasa ðŸš€</button>
    <div id="loading" class="loading-text">Inasindika... Subiri kidogo...</div>
    <div id="status"></div>
</div>

<script>
    async function sendSMS() {
        const btn = document.getElementById('submitBtn');
        const loading = document.getElementById('loading');
        const statusDiv = document.getElementById('status');
        
        const contacts = document.getElementById('contacts').value.trim();
        const message = document.getElementById('message').value.trim();

        if (!contacts || !message) {
            alert("Oya, usisahau kujaza namba au ujumbe!");
            return;
        }

        // Setup UI
        btn.disabled = true;
        loading.style.display = 'block';
        statusDiv.style.display = 'none';

        const payload = {
            sender_id: "Sensible",
            message_type: "text",
            message: message,
            contacts: contacts
        };

        try {
            // Tunaita API yetu ya Vercel (Local Proxy)
            const response = await fetch("/api/send-sms", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload)
            });

            const result = await response.json();
            statusDiv.style.display = 'block';

            if (response.ok) {
                statusDiv.className = 'status success';
                statusDiv.innerHTML = `<strong>Safi!</strong><br>SMS imetumwa. Batch ID: ${result.batch_id || 'N/A'}`;
            } else {
                statusDiv.className = 'status error';
                statusDiv.innerHTML = `<strong>Kuna Error:</strong><br>${result.error || result.message || 'Jaribu tena baadaye.'}`;
            }
        } catch (err) {
            statusDiv.style.display = 'block';
            statusDiv.className = 'status error';
            statusDiv.innerText = "Network Error: " + err.message;
        } finally {
            btn.disabled = false;
            loading.style.display = 'none';
        }
    }
</script>

</body>
</html>
